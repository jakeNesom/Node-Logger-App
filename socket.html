<!DOCTYPE html>
<html lang="en">
<head>
    <title>webSockets and Socket.IO</title>
    <script type="text/javascript" src="/socket.io/socket.io.js"></script>
    <!--The above library(/socket.io/socket.io.js) will be generated by socket.io module of server -->
    <script type="text/javascript" src="http://code.jquery.com/jquery-1.10.2.min.js"></script>

    <!-- Front end prettifying with bootstrap-->
    <link rel="stylesheet" type="text/css" href="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.3.7/css/bootstrap.min.css" />
    <link rel="stylesheet" type="text/css" href="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.3.7/css/bootstrap-theme.min.css" />
    <script src="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.3.7/js/bootstrap.min.js"></script>


    <script>
        var logType = ["Information", "Error", "Exception", "Trace", "Debug" ];
        function nodeGen() {
            return "node " + (1 + Math.floor(Math.random() * 6));
        }
        function logTypeGen() {
            return  (1 + Math.floor(Math.random() * 4));
        }

        function clientGen() {
            return "client " + (1 + Math.floor(Math.random() * 10));
        }
        var alStarted = false;

        function totalEntriesGenerated(maxEntries) {
            return (1 + Math.floor(Math.random() * maxEntries));
        }
        function newEntry() {

            var node = nodeGen().toString();
            var client = clientGen().toString();

        }

        function sendClients(number)
        {
            for (var i = 0; i < number; i++) {
                var date = new Date();                
                var data = {
                    "Node": nodeGen().toString(),
                    "Client": clientGen().toString(),
                    "Time": date.getTime(),
                    "Message": "message",
                    "LogType": logType[0]
                }
                socket.send(JSON.stringify(data));
            }
            for(var i = 0; i < number; i++ )
            {
                var date = new Date();
                var count = logTypeGen();
                var data = {
                    "Node": nodeGen().toString(),
                    "Client": clientGen().toString(),
                    "Time": date.getTime(),
                    "Message": "message",
                    "LogType": logType[count]
                }
                socket.send(JSON.stringify(data));
            }
        }
        var myInterval;
        function startInterval () {
            myInterval = setInterval(function () {
                var numberOfEntries = (1 + Math.floor(Math.random() * 20));
                console.log("Interval Fired + Num of entries: " + numberOfEntries);
                sendClients(numberOfEntries);
            }, 5000);
        }

        function sendClientsInterval(totalEntries, timeframe) {
            var currentTime = new Date().getTime();
            var startTime = currentTime - timeframe;
            for (var i = 0; i < totalEntries; i++) {
                var date = new Date();
                var data = {
                    "Node": nodeGen().toString(),
                    "Client": clientGen().toString(),
                    "Time": startTime + Math.floor((Math.random() * timeframe) + 60000),
                    "Message": "message",
                    "LogType": logType[0]
                }
                socket.send(JSON.stringify(data));
            }
            for (var i = 0; i < totalEntries; i++) {
                var date = new Date();
                var count = logTypeGen();
                var data = {
                    "Node": nodeGen().toString(),
                    "Client": clientGen().toString(),
                    "Time": startTime + Math.floor((Math.random() * timeframe) + 60000),
                    "Message": "message",
                    "LogType": logType[count]
                }
                socket.send(JSON.stringify(data));
            }
        }
    </script>

    <style>
        #started {
            background-color: red;
        }
    </style>
</head>
<body>
    <!--form to receive client server info
    <form>
        Client Information: <input type="text" id="client">
        <input type="submit" value="Submit">
    </form>-->
    <!-- form to get logging data -->
    <div class="container">
        <div class="row" style="margin-top: 100px;">
            <div class="col-xs-10 col-xs-offset-1 col-sm-8 col-sm-offset-2 col-md-6 col-md-offset-3 col-lg-6 col-lg-offset-3">
                <div style="border-style: solid; border-width: 1px 2px 2px 1px; border-color: lightgrey; border-radius: 10px; padding: 15px;">
                    <ul class="nav nav-tabs">
                        <li class="active"><a data-toggle="tab" href="#manualLogger">Manual-Logger</a></li>
                        <li><a data-toggle="tab" href="#autoLogger">Auto-Logger</a></li>
                        <li><a data-toggle="tab" href="#entriesByTime">EntriesByTime</a></li>

                    </ul>

                    <div class="tab-content">
                        <div id="manualLogger" class="tab-pane fade in active">
                            <div class="well" style="margin: 5px;">
                                <h4> Manual Logger </h4>
                                <form style="margin-top:15px;">
                                    <div class="form-group">
                                        <label for="client">Client:</label>  <!--text form to send client info to the server-->
                                        <input type="text" class="form-control" id="client" placeholder="Enter Client" />
                                    </div>
                                    <div class="form-group">
                                        <label for="logData">Log Data: </label>  <!--text form to send client info to the server-->
                                        <input type="text" class="form-control" id="message" placeholder="Enter Message" />
                                    </div>
                                    <button type="submit" id="submit" class="btn btn-default">Send to server</button>
                                </form>
                            </div>
                        </div>
                        <div id="autoLogger" class="tab-pane fade">
                            <div class="well" style="margin: 5px;">
                                <h4>Auto-Logger</h4>
                                <p>This generates automatic logger entries over a period of time </p>
                                <form>
                                    <div id="alSubmit" class="btn btn-default">Start Logger</div>
                                </form>
                            </div>
                        </div>
                        <div id="entriesByTime" class="tab-pane fade">
                            <div class="well" style="margin: 5px;">
                                <h4>Entries By Time</h4>
                                <p>This generates random entries in a given time period </p>
                                <form>
                                    <div class="form-group">
                                        <label for="timeFrames">Select</label>
                                        <select class="form-control" id="timeFrames">
                                            <option>Last 30 min</option>
                                            <option>Last Hour</option>
                                            <option>Last 24 Hours</option>
                                            <option>Last 7 days</option>
                                            <option>Last Month</option>
                                        </select>
                                    </div>
                                    <div id="genEntriesByTime" class="btn btn-default">Generate</div>
                                </form>
                            </div>
                        </div>
                    </div>

                </div>

                <!--
                Client info: <input type="text" id="client" /> <!--text form to send client info to the server-->
                <!-- Log data: <input type="text" id="message" /> <br><!--text form to send data to the server-->
                <!-- <input id="submit" type="button" value="Send data to Server">
                <div id="content"></div> <!--This is where the data from the server is added-->


            </div> <!-- End of column -->
        </div> <!-- end of row -->
    </div> <!-- end of container -->
    <script type="text/javascript">
        var socket = io.connect("/");

            /*Initializing the connection with the server via websockets */
            socket.on("message",function(message){
                /*
                    When server sends data to the client it will trigger "message" event on the client side , by
                    using socket.on("message") , one cna listen for the ,message event and associate a callback to
                    be executed . The Callback function gets the data sent from the server
                */


                console.log("Message from the server arrived")
                message = JSON.parse(message);
                console.log(message); /*converting the data into JS object */
                $('#content').append('<div >'+message.data+'</div>'); /*appending the data on the page using Jquery */
            });
            $(function(){
                var date = new Date();
                $('#submit').click(function(){ /*listening to the button click using Jquery listener*/
                    var data = { /*creating a Js ojbect to be sent to the server*/
                        client: $('#client').val(),
                        message:$('#message').val(), /*getting the text input data      */
                        time:date.getTime(),

                        // Generating false random node for testing -- by JN
                        node: nodeGen().toString()
                    }
                    socket.send(JSON.stringify(data));
                    /*Data can be sent to server very easily by using socket.send() method
                    The data has to be changed to a JSON before sending
                                          it (JSON.stringify() does this job )*/
                    /* This triggers a message event on the server side
                    and the event handler obtains the data sent */

                    $('#message').val('');
                    $('#client').val('');
                    //Emptying the text box value using jquery

                });
                $("#alSubmit").click(function () {
                    if (alStarted == false)
                    {
                        alStarted = true;
                        $('#alSubmit').attr('class', 'btn btn-danger');
                        $('#alSubmit').text('Stop Logger');
                        console.log("alSubmit Clicked: " + alStarted);
                        startInterval();

                    }
                    else if ( alStarted == true )
                    {
                        alStarted = false;
                        $('#alSubmit').attr('class', 'btn btn-default');
                        $('#alSubmit').text('Start Logger');
                        //console.log("alSubmit Clicked: " + alStarted);
                        console.log("interval Cleared");
                        clearInterval(myInterval);
                    }


                });
            });
            $('#genEntriesByTime').click(function () {
                var select = $('#timeFrames option:selected').text().toString();
                if (!select || select !== 'Last 30 min') {
                    console.log('Only "Last 30 Min" works right now');
                } else {
                    sendClientsInterval(totalEntriesGenerated(50), 1800000);
                }
            });

    </script>
</body>
</html>